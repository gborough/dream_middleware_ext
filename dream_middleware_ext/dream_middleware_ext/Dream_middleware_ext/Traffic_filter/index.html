<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Traffic_filter (dream_middleware_ext.Dream_middleware_ext.Traffic_filter)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">dream_middleware_ext</a> &#x00BB; <a href="../index.html">Dream_middleware_ext</a> &#x00BB; Traffic_filter</nav><header class="odoc-preamble"><h1>Module <code><span>Dream_middleware_ext.Traffic_filter</span></code></h1><p>Traffic filter middleware</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-traffic_filter_conf"><a href="#type-traffic_filter_conf" class="anchor"></a><code><span><span class="keyword">type</span> traffic_filter_conf</span></code></div><div class="spec-doc"><p>The type of configuration for traffic filter</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-filter_type"><a href="#type-filter_type" class="anchor"></a><code><span><span class="keyword">type</span> filter_type</span><span> = </span></code><ol><li id="type-filter_type.Ips" class="def variant constructor anchored"><a href="#type-filter_type.Ips" class="anchor"></a><code><span>| </span><span><span class="constructor">Ips</span> <span class="keyword">of</span> <a href="#type-ip_filter">ip_filter</a></span></code></li><li id="type-filter_type.Headers" class="def variant constructor anchored"><a href="#type-filter_type.Headers" class="anchor"></a><code><span>| </span><span><span class="constructor">Headers</span> <span class="keyword">of</span> <span>string list</span></span></code></li><li id="type-filter_type.Cookies" class="def variant constructor anchored"><a href="#type-filter_type.Cookies" class="anchor"></a><code><span>| </span><span><span class="constructor">Cookies</span> <span class="keyword">of</span> <span>string list</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The type of traffic filter: 1. Ips -&gt; ip based filter , 2. Headers -&gt; header based filter 3. Cookies -&gt; cookie based filter</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ip_filter"><a href="#type-ip_filter" class="anchor"></a><code><span><span class="keyword">and</span> ip_filter</span><span> = </span><span>{</span></code><ol><li id="type-ip_filter.whitelist" class="def record field anchored"><a href="#type-ip_filter.whitelist" class="anchor"></a><code><span>whitelist : <span>string list</span>;</span></code></li><li id="type-ip_filter.blacklist" class="def record field anchored"><a href="#type-ip_filter.blacklist" class="anchor"></a><code><span>blacklist : <span>string list</span>;</span></code></li><li id="type-ip_filter.x_real_ip" class="def record field anchored"><a href="#type-ip_filter.x_real_ip" class="anchor"></a><code><span>x_real_ip : bool;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type of ip based filter that takes a whitelist and a blacklist, conditionally matching on X-REAL-IP header</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-target_type"><a href="#type-target_type" class="anchor"></a><code><span><span class="keyword">type</span> target_type</span><span> = </span></code><ol><li id="type-target_type.RootAccess" class="def variant constructor anchored"><a href="#type-target_type.RootAccess" class="anchor"></a><code><span>| </span><span><span class="constructor">RootAccess</span></span></code></li><li id="type-target_type.PathList" class="def variant constructor anchored"><a href="#type-target_type.PathList" class="anchor"></a><code><span>| </span><span><span class="constructor">PathList</span> <span class="keyword">of</span> <span>string list</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The type of path target: 1. RootAccess -&gt; i.e. &quot;/&quot;, 2. PathList -&gt; a list of paths</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-InvalidIp"><a href="#exception-InvalidIp" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">InvalidIp</span> <span class="keyword">of</span> string</span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-OverlappingIps"><a href="#exception-OverlappingIps" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">OverlappingIps</span> <span class="keyword">of</span> string</span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-InvalidTarget"><a href="#exception-InvalidTarget" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">InvalidTarget</span> <span class="keyword">of</span> string</span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-EmptyHeaderList"><a href="#exception-EmptyHeaderList" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">EmptyHeaderList</span> <span class="keyword">of</span> string</span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-EmptyCookieList"><a href="#exception-EmptyCookieList" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">EmptyCookieList</span> <span class="keyword">of</span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_traffic_filter_conf"><a href="#val-make_traffic_filter_conf" class="anchor"></a><code><span><span class="keyword">val</span> make_traffic_filter_conf : 
  <span><span class="label">filter_type</span>:<a href="#type-filter_type">filter_type</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?target</span>:<a href="#type-target_type">target_type</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-traffic_filter_conf">traffic_filter_conf</a></span></code></div><div class="spec-doc"><p><code>make_traffic_filter_conf m n o</code> makes a traffic filter configuration that takes a <code>m</code> filter type and a <code>n</code> target path</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_traffic_filter"><a href="#val-make_traffic_filter" class="anchor"></a><code><span><span class="keyword">val</span> make_traffic_filter : 
  <span><span class="label">conf</span>:<a href="#type-traffic_filter_conf">traffic_filter_conf</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?err_msg</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Dream</span>.handler <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Dream</span>.response <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>make_traffic_filter m  n</code> makes a traffic filter middleware that takes a <code>m</code> configuration, and a boolean <code>o</code> returns custom Unauthorized message</p></div></div></div></body></html>
